{
    auto_https off
}

:80, www.server96.com, server96.com, www.knowabt.me, knowabt.me {
    @subdomain header_regexp sub Host ^([^.]+)\.(server96\.com|knowabt\.me)$

    # Handle portfolio subdomains
    handle @subdomain {
        root * /var/www/portfolios/{re.sub.1}
        file_server
        try_files {path} {path}/ /index.html
    }

    # Handle backend API routes - proxy to manager
    handle /auth/* {
        reverse_proxy manager:3000
    }

    handle /admin* {
        reverse_proxy manager:3000
    }

    handle /health {
        reverse_proxy manager:3000
    }

    handle /deploy* {
        reverse_proxy manager:3000
    }

    handle /deployments* {
        reverse_proxy manager:3000
    }

    handle /sites* {
        reverse_proxy manager:3000
    }

    handle /search* {
        reverse_proxy manager:3000
    }

    handle /skills* {
        reverse_proxy manager:3000
    }

    handle /top-repos {
        reverse_proxy manager:3000
    }

    # Default - route everything else (including /api/* for Next.js) to frontend
    handle {
        reverse_proxy frontend:3000
    }
}


